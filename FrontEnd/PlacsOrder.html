<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AdminLTE 2 | Dashboard</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="bower_components/morris.js/morris.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <header class="main-header">
    <!-- Logo -->
    <a href="" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>A</b>LT</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>Modern</b>POS</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>

      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          
        </ul>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>Alexander Pierce</p>
          <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
        </div>
      </div>
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu" data-widget="tree">
        <li class="header">MAIN NAVIGATION</li>
        
        <li>
          <a href="index.html">
            <i class="fa fa-th"></i> <span>Dashboard</span>
            <span class="pull-right-container">
            </span>
          </a>
        </li>

        <li>
          <a href="customer.html">
            <i class="fa fa-th"></i> <span>Customer</span>
            <span class="pull-right-container">
            </span>
          </a>
        </li>

        <li>
          <a href="Items.html">
            <i class="fa fa-th"></i> <span>Items</span>
            <span class="pull-right-container">
            </span>
          </a>
        </li>

        <li>
          <a href="PlacsOrder.html">
            <i class="fa fa-th"></i> <span>PalceOrder</span>
            <span class="pull-right-container">
            </span>
          </a>
        </li>

        <li>
          <a href="OrderDetails.html">
            <i class="fa fa-th"></i> <span>OrdeDetails</span>
            <span class="pull-right-container">
            </span>
          </a>
        </li>
        
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Manage
        <small>Place Order</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Dashboard</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
     <!-- Small boxes (Stat box) -->
      <!-- /.row -->
      <!-- Main row -->
      
      <!-- /.row (main row) -->
      <div class="row">
          <div class="col-md-12">
          <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title"><button type="button" class="btn btn-block btn-info"><i class="fa fa-fw fa-user-plus" id="btnNewOrder"></i>  Add New Order</button></h3>
              </div>
              <!-- /.box-header -->
              <!-- form start -->
              <form role="form">
                <div class="box-body">
                    <div class="col-md-4">
                        <div class="col-md-12">
                            <div class="box box-warning">
                              <div class="box-header with-border">
                                  <div>Order ID: <label id="lblOrderId"></label></div>
                  
                                
                                <!-- /.box-tools -->
                              </div>
                              <!-- /.box-header -->
                              <div class="box-body">
                                  <div>Order Date: <label id="lblOrderDate"></label></div>
                              </div>
                              <!-- /.box-body -->
                            </div>
                            <!-- /.box -->
                          </div>

                          <div class="col-md-12">
                              <div class="box box-warning">
                                <div class="box-header with-border">
                                    <div class="form-group">
                                        Customer ID:
                                        <select id="cmbCustomerID" class="form-control">
                                            <option selected disabled hidden value="">Select Customer ID</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- /.box-header -->
                                <div class="box-body">
                                    <div>Customer Name: <label id="lblCustomerName"></label></div>
                                </div>
                                <!-- /.box-body -->
                              </div>
                              <!-- /.box -->
                            </div>

                            <div class="col-md-12">
                                <div class="box box-warning">
                                  <div class="box-header with-border">
                                      <div class="form-group">
                                          
                                              Item Code:
                                              <select id="cmbItemCode" class="form-control">
                                                  <option selected disabled hidden value="">Select Item Code</option>
                                              </select>
                                          
                                      </div>
                                  </div>
                                  <!-- /.box-header -->
                                  <div class="box-body">
                                      <div id="item-details">
                                          <div>Item Description: <label id="lblItemDescription"></label></div>
                                          <div>Unit Price: <label id="lblUnitPrice"></label></div>
                                          <div>Qty. On Hand: <label id="lblQtyOnHand"></label></div>
                                      </div>
                                  </div>

                                  <div class="box-body">
                                      <div class="form-group">
                                          Qty.
                                          <input class="form-control" type="number" id="txtQty">
                                      </div>
                                      
                                  </div>

                                  <div class="box-body">
                                      <button id="btnAddCart" type="button" class="btn btn-warning"> <i class="fas fa-cart-plus"></i> Add to Cart</button>
                                      
                                  </div>
                                  <!-- /.box-body -->
                                </div>
                                <!-- /.box -->
                              </div>


                    </div>

                    <div class="col-md-8">

                        <div class="col-md-12">
                            <div class="box box-warning">
                              <div class="box-header with-border">
                                  <table class="table table-hover table-dark" id="tblOrderDetails">
                                      <thead>
                                        <tr>
                                          <th >Code</th>
                                          <th >Description</th>
                                          <th >Unit Price</th>
                                          <th >Qty</th>
                                          <th >Total</th>
                                          <th></th>

                                        </tr>
                                      </thead>
                                      
                                          <tbody>
                                          
                                          </tbody>
                                      <tbody>
                                        
                                      </tbody>
                                    </table>
                                <!-- /.box-tools -->
                              </div>
                              <!-- /.box-header -->
                              <div class="box-body">
                                  <div>
                                      <span id="spnTotal">Total: <label id="lblTotal">0.0</label></span>
                                      <button id="btnPlaceOrder" type="button" style="text-align: right" class="btn btn-primary"> <i class="fas fa-cart-arrow-down"></i>
                                          Place Order</button>
                                  </div>
                              </div>
                              <!-- /.box-body -->
                            </div>
                            <!-- /.box -->
                            
                          </div>
                    </div>
                    

                    </div>
                  
                </div>

                
               
  
                
              </form>
</div>
              

            </div>

            <div class="row">
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-header">
                          <h3 class="box-title">Items Data Table</h3>
                        </div>

                        <div class="box-body">
                            <table id="tblOrderDetail" class="table table-bordered table-hover">
                              <thead>
                              <tr>
                                <th>Code</th>
                                <th>Description</th>
                                <th>Unit Price</th>
                                <th>Qty</th>
                                <th></th>
                                
                              </tr>
                              </thead>
                              <tbody>
                              
                              </tbody>
                              <tfoot>
                              
                              </tfoot>
                            </table>
                          </div>
                          <!-- bhb -->

                          
                </div>
              </div>
      </div>
    
    <!-- Small boxes (Stat box) -->
    <!-- /.row -->
    <!-- Main row -->
    
    <!-- /.row (main row) -->

    

    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>Version</b> 2.4.0
    </div>
    <strong>Copyright &copy; 2018-2019 <a href="https://adminlte.io">DEP</a>.</strong> All rights
    reserved.
  </footer>

  <!-- Control Sidebar -->
  
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  
</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="bower_components/raphael/raphael.min.js"></script>
<script src="bower_components/morris.js/morris.min.js"></script>
<!-- Sparkline -->
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="bower_components/moment/min/moment.min.js"></script>
<script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="dist/js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script src="js/in-mem-db.js"></script>
    <!-- http://blog.stevenlevithan.com/archives/date-time-format -->
    <script src="js/date-formatter.js"></script>
<script>
function setToday() {
            var today = new Date();
            // Just need to parse the format that you need
            var formattedDate = today.format("yyyy-mm-dd");
            $("#lblOrderDate").text(formattedDate);
        }

        setToday();

        var ordersDetails = [];

        $(document).ready(function () {

            for (var i = 0; i < CUSTOMERS.length; i++) {
                $("#cmbCustomerID").append('<option value="' + CUSTOMERS[i].id + '">' + CUSTOMERS[i].id + '</option>')
            }

            for (var i = 0; i < ITEMS.length; i++) {
                $("#cmbItemCode").append('<option value="' + ITEMS[i].code + '">' + ITEMS[i].code + '</option>')
            }

            reset();

        });

        function findCustomer(customerId) {
            for (var index in CUSTOMERS) {
                var customer = CUSTOMERS[index];
                if (customer.id == customerId) {
                    return customer;
                }
            }
        }

        function findItem(itemCode) {
            for (var index in ITEMS) {
                var item = ITEMS[index];
                if (item.code == itemCode) {
                    return item;
                }
            }
        }

        $("#btnNewOrder").click(function () {

            $("#tblOrderDetails tbody tr").each(function () {
                var itemCode = $(this).find("td:first-child").text().trim();
                var qty = parseInt($(this).find('td:nth-child(4)').text().trim());
                var item = findItem(itemCode);
                item.qtyOnHand += qty;
            });

            reset();

            var lastOrderId = $("#tblOrders tbody tr:last-child td:first-child").text();
            var orderId = 1;
            if (lastOrderId) {
                orderId = parseInt(lastOrderId) + 1;
            }
            $("#lblOrderId").text(orderId);

            $("#cmbCustomerID").attr("disabled", false);
            $("#cmbItemCode").attr("disabled", false);
            $("#btnAddCart").attr("disabled", false);
            $("#txtQty").attr("disabled", false);
            $("#btnPlaceOrder").attr("disabled", false);
        });

        $("#cmbCustomerID").change(function () {
            var customerId = $(this).val();
            if (!customerId) {
                customerName = "";
            } else {
                var customerName = findCustomer(customerId).name;
            }
            $("#lblCustomerName").text(customerName);
        });

        $("#cmbItemCode").change(function () {
            var itemCode = $(this).val();
            if (itemCode) {
                var item = findItem(itemCode);
                $("#lblItemDescription").text(item.description);
                $("#lblUnitPrice").text(item.unitPrice);
                $("#lblQtyOnHand").text(item.qtyOnHand);
            } else {
                $("#lblItemDescription").text("");
                $("#lblUnitPrice").text("");
                $("#lblQtyOnHand").text("");
                $("#txtQty").val("");
            }
        });

        $("#btnAddCart").click(function () {

var itemCode = $("#cmbItemCode").val();
var itemDescription = $("#lblItemDescription").text();
var unitPrice = parseFloat($("#lblUnitPrice").text());
var qty = parseInt($("#txtQty").val());
var total = unitPrice * qty;
var item = findItem(itemCode);

if (qty <= 0 || qty > item.qtyOnHand) {
    alert("Invalid Qty");
    $("#txtQty").addClass('invalid-qty');
    return;
}

$("#txtQty").removeClass('invalid-qty');

var currentRow = isItemExists(itemCode);

// Determines whether I want to update or add
if ($("#btnAddCart").text().trim() == "Update Cart") {
    // Update
    var currentQty = parseInt($(currentRow).find("td:nth-child(4)").text());
    item.qtyOnHand += currentQty;
    $(currentRow).find("td:nth-child(4)").text(qty);
    $(currentRow).find("td:nth-child(5)").text(total);
    calculateTotal();

    item.qtyOnHand -= qty;
    $("#btnAddCart").html('<i class="fas fa-cart-plus"></i> Add to Cart');
    $("#cmbItemCode").val("").trigger("change");
    $("#cmbItemCode").attr("disabled", false);
    // $("#txtQty").attr("disabled",false);

    return;
}


if (currentRow) {
    var currentQty = parseInt($(currentRow).find("td:nth-child(4)").text());
    currentQty += qty;
    total = unitPrice * currentQty;
    $(currentRow).find("td:nth-child(4)").text(currentQty);
    $(currentRow).find("td:nth-child(5)").text(total);
    calculateTotal();

    item.qtyOnHand -= qty;
    $("#cmbItemCode").val("").trigger("change");

    return;
}

var html = `<tr>
                <td class="text-center">${itemCode}</td>
                <td>${itemDescription}</td>
                <td class="text-right">${unitPrice}</td>
                <td class="text-center">${qty}</td>
                <td class="text-right">${total}</td>
                <td><div class="icon-delete"></div></td>
            </tr>`;

item.qtyOnHand -= qty;
$("#tblOrderDetails tbody").append(html);

calculateTotal();
$("#cmbItemCode").val("").trigger("change");

$("#tblOrderDetails tbody tr").off("click");
$("#tblOrderDetails tbody tr").click(function () {
    var itemCode = $(this).find("td:first-child").text();
    var qty = parseInt($(this).find("td:nth-child(4)").text());
    $("#cmbItemCode").val(itemCode).trigger("change");
    $("#txtQty").val(qty);
    $("#btnAddCart").html('<i class="fas fa-cart-plus"></i> Update Cart');
    $("#cmbItemCode").attr("disabled", true);
});

$("#tblOrderDetails .icon-delete").off("click");
$("#tblOrderDetails .icon-delete").click(function (eventData) {
    eventData.stopPropagation();
    if (confirm("Are you sure that you want to delete this item?")) {
        var qty = parseInt($(this).parents("tr").find("td:nth-child(4)").text());
        var itemCode = $(this).parents("tr").find("td:first-child").text();
        var item = findItem(itemCode);
        item.qtyOnHand += qty;

        $(this).fadeOut(500, function () {
            $(this).parents("tr").remove();
            calculateTotal();
        });
    }
});



});

function isItemExists(code) {
var flag = null;
$("#tblOrderDetails tbody tr").each(function () {
    var itemCode = $(this).find("td:first-child").text();
    if (itemCode == code) {
        flag = this;
        return;
    }
});
return flag;
}

function calculateTotal() {
var total = 0.0;
$("#tblOrderDetails tbody tr").each(function () {
    total += parseFloat($(this).find("td:nth-child(5)").text());
});
$("#lblTotal").text(total);
}

$("#btnPlaceOrder").click(function () {

var rowCount = $("#tblOrderDetails tbody tr").length;
if (rowCount == 0) {
    alert("In order to place an order there should be at least one order detail");
    return;
}

var orderId = $("#lblOrderId").text().trim();
var orderDate = $("#lblOrderDate").text().trim();
var customerId = $("#cmbCustomerID").val();
var customerName = $("#lblCustomerName").text().trim();
var orderTotal = $("#lblTotal").text().trim();

if (!customerId) {
    alert("In order to place an order customer should be selected");
    return;
}

$("#tblOrderDetails tbody tr").each(function () {

    var itemCode = $(this).find("td:first-child").text();
    var description = $(this).find("td:nth-child(2)").text();
    var unitPrice = $(this).find("td:nth-child(3)").text();
    var qty = $(this).find("td:nth-child(4)").text();
    var total = $(this).find("td:nth-child(5)").text();

    var orderDetail = {
        orderId: orderId,
        itemCode: itemCode,
        description: description,
        unitPrice: unitPrice,
        qty: qty,
        total: total
    };

    ordersDetails.push(orderDetail);

});

var html = `<tr>
                <td class="text-center">${orderId}</td>
                <td class="text-center">${orderDate}</td>
                <td class="text-center">${customerId}</td>
                <td>${customerName}</td>
                <td class="text-right">${orderTotal}</td>
            </tr>`;

$("#tblOrders tbody").append(html);
// reset();

$("#tblOrders tbody tr").off("click");
$("#tblOrders tbody tr").click(function () {
    // reset();
    var orderId = $(this).find("td:first-child").text();
    var orderDate = $(this).find("td:nth-child(2)").text();
    var customerId = $(this).find("td:nth-child(3)").text();

    $("#lblOrderId").text(orderId);
    $("#lblOrderDate").text(orderDate);
    $("#cmbCustomerID").val(customerId).trigger("change");

    var orderDetails = ordersDetails.filter(function (element) {
        return element.orderId == orderId;
    });

    for (var i = 0; i < orderDetails.length; i++) {
        var html = `<tr>
                        <td class="text-center">${orderDetails[i].itemCode}</td>
                        <td>${orderDetails[i].description}</td>
                        <td class="text-right">${orderDetails[i].unitPrice}</td>
                        <td class="text-center">${orderDetails[i].qty}</td>
                        <td class="text-right">${orderDetails[i].total}</td>
                        <td><div class="icon-delete icon-disabled"></div></td>
                    </tr>`;

        $("#tblOrderDetails tbody").append(html);
    }
    calculateTotal();

    $("#tblOrderDetails tbody tr").click(function () {
        var itemCode = $(this).find("td:first-child").text();
        var qty = parseInt($(this).find("td:nth-child(4)").text());
        $("#cmbItemCode").val(itemCode).trigger("change");
        $("#txtQty").val(qty);
        // $("#btnAddCart").html('<i class="fas fa-cart-plus"></i> Update Cart');
        // $("#cmbItemCode").attr("disabled", true);
    });

});

});

        function reset() {
            $("#lblOrderId").text("");
            setToday();
            $("#cmbCustomerID").attr("disabled", true);
            $("#cmbItemCode").attr("disabled", true);
            $("#cmbCustomerID").val("").trigger("change");
            $("#cmbItemCode").val("").trigger("change");
            $("#txtQty").val("");
            $("#txtQty").attr("disabled", true);
            $("#btnAddCart").attr("disabled", true);
            // $("#tblOrderDetails tbody tr").remove();
            $("#lblTotal").text("0");
            $("#btnPlaceOrder").attr("disabled", true);
        }

</script>
</body>
</html>
